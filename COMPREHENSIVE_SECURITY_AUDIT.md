# üîí –ü–û–õ–ù–´–ô –ê–£–î–ò–¢ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò –ò –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò
## –û—Ç—á–µ—Ç Senior QA –∏–Ω–∂–µ–Ω–µ—Ä–∞ –∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –ø–æ –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–î–∞—Ç–∞:** 2024-12-19  
**–í–µ—Ä—Å–∏—è:** 2.0  
**–°—Ç–∞—Ç—É—Å:** –ì–ª—É–±–æ–∫–∏–π –∞—É–¥–∏—Ç –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

---

## üìä –û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê

- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:** 50+
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π:** 8
- **–í—ã—Å–æ–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º:** 12
- **–°—Ä–µ–¥–Ω–µ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º:** 15
- **–ù–∏–∑–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π:** 10
- **–í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º:** 45

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### 1. üî¥ RACE CONDITION –í SQUADS - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

**–§–∞–π–ª:** `server/routes/squads.js:234-295, 297-349, 352-420`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å / Race Condition

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –û–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ù–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ `FOR UPDATE` –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ squad
- –í–æ–∑–º–æ–∂–Ω–∞ –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- JSON –º–∞—Å—Å–∏–≤ `members` —á–∏—Ç–∞–µ—Ç—Å—è, –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –±–µ–∑ –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏

**–ü—Ä–∏–º–µ—Ä —É—è–∑–≤–∏–º–æ—Å—Ç–∏:**
```javascript
// –¢–µ–∫—É—â–∏–π –∫–æ–¥ (–ù–ï–ë–ï–ó–û–ü–ê–°–ù–û):
const squad = squadResult.rows[0];
const members = squad.members || [];
members.push(newMember); // Race condition –∑–¥–µ—Å—å!
await pool.query(`UPDATE squads SET members = $1 ...`, [JSON.stringify(members)]);
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
// –ù–£–ñ–ù–û:
const client = await pool.connect();
try {
  await client.query('BEGIN');
  const squadResult = await client.query(
    `SELECT * FROM squads WHERE id = $1 FOR UPDATE`,
    [squadId]
  );
  // ... –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è members ...
  await client.query('COMMIT');
} catch (error) {
  await client.query('ROLLBACK');
  throw error;
} finally {
  client.release();
}
```

---

### 2. üî¥ RACE CONDITION –í WITNESSES - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

**–§–∞–π–ª:** `server/routes/witnesses.js:244-277`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å / Race Condition

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–≤–∏–¥–µ—Ç–µ–ª—è –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- –í–æ–∑–º–æ–∂–Ω–∞ –¥–≤–æ–π–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ witness

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –∏ –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º.

---

### 3. üî¥ –ù–ï–î–û–°–¢–ê–¢–û–ß–ù–ê–Ø –í–ê–õ–ò–î–ê–¶–ò–Ø JSONB –í SQUADS

**–§–∞–π–ª:** `server/routes/squads.js:264, 280, 330, 397`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å / Injection

**–ü—Ä–æ–±–ª–µ–º–∞:**
- JSON.stringify –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑–º–µ—Ä–∞ –º–∞—Å—Å–∏–≤–∞ members
- –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–ª–µ–π –≤ –æ–±—ä–µ–∫—Ç–µ member
- –í–æ–∑–º–æ–∂–Ω–∞ DoS —á–µ—Ä–µ–∑ –æ–≥—Ä–æ–º–Ω—ã–π JSON

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- DoS —á–µ—Ä–µ–∑ –æ–≥—Ä–æ–º–Ω—ã–π JSON payload
- –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ë–î
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
// –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é:
if (members.length > 100) {
  return sendError(res, 400, 'TOO_MANY_MEMBERS', 'Maximum 100 members per squad');
}
// –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞–∂–¥–æ–≥–æ member
for (const member of members) {
  if (!member.id || typeof member.id !== 'string') {
    return sendError(res, 400, 'INVALID_MEMBER', 'Invalid member structure');
  }
}
```

---

### 4. üî¥ –û–¢–°–£–¢–°–¢–í–ò–ï –ò–ù–î–ï–ö–°–ê –î–õ–Ø JSONB QUERIES –í SQUADS

**–§–∞–π–ª:** `server/routes/squads.js:24-28`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å / Database

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ó–∞–ø—Ä–æ—Å `members @> $2::jsonb` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ –∏–Ω–¥–µ–∫—Å–∞
- –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ squads –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω—ã–º
- –ù–µ—Ç GIN –∏–Ω–¥–µ–∫—Å–∞ –¥–ª—è JSONB –æ–ø–µ—Ä–∞—Ü–∏–π

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```sql
CREATE INDEX IF NOT EXISTS idx_squads_members_gin ON squads USING GIN (members);
```

---

### 5. üî¥ –û–¢–°–£–¢–°–¢–í–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò –†–ê–ó–ú–ï–†–ê sharedPayload

**–§–∞–π–ª:** `server/routes/squads.js:177-180`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å / DoS

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `sharedPayload` –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
- –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –¥–ª–∏–Ω—É —Ç–µ–∫—Å—Ç–∞
- –í–æ–∑–º–æ–∂–Ω–∞ DoS —á–µ—Ä–µ–∑ –æ–≥—Ä–æ–º–Ω—ã–π payload

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
if (sharedPayload && sharedPayload.length > 10000) {
  return sendError(res, 400, 'PAYLOAD_TOO_LARGE', 'sharedPayload exceeds 10KB limit');
}
```

---

### 6. üî¥ –û–¢–°–£–¢–°–¢–í–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò memberName –ò avatarId

**–§–∞–π–ª:** `server/routes/squads.js:247, 274, 277`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å / Injection

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `memberName` –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –¥–ª–∏–Ω—É –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
- `avatarId` –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
- –í–æ–∑–º–æ–∂–Ω–∞ –∏–Ω—ä–µ–∫—Ü–∏—è —á–µ—Ä–µ–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
if (memberName && (memberName.length > 255 || !/^[\w\s-]+$/.test(memberName))) {
  return sendError(res, 400, 'INVALID_MEMBER_NAME', 'Invalid member name');
}
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å avatarId —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
```

---

### 7. üî¥ –û–¢–°–£–¢–°–¢–í–ò–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø –ù–ê –ö–û–õ–ò–ß–ï–°–¢–í–û –£–ß–ê–°–¢–ù–ò–ö–û–í

**–§–∞–π–ª:** `server/routes/squads.js:267, 379`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å / DoS

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ squad
- –í–æ–∑–º–æ–∂–Ω–∞ DoS —á–µ—Ä–µ–∑ —Å–æ–∑–¥–∞–Ω–∏–µ –æ–≥—Ä–æ–º–Ω–æ–≥–æ –º–∞—Å—Å–∏–≤–∞ members

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
const MAX_MEMBERS = 50;
if (members.length >= MAX_MEMBERS) {
  return sendError(res, 400, 'SQUAD_FULL', `Maximum ${MAX_MEMBERS} members allowed`);
}
```

---

### 8. üî¥ –û–¢–°–£–¢–°–¢–í–ò–ï –ü–†–û–í–ï–†–ö–ò –ü–†–ê–í –î–û–°–¢–£–ü–ê –ü–†–ò –î–û–ë–ê–í–õ–ï–ù–ò–ò –£–ß–ê–°–¢–ù–ò–ö–û–í

**–§–∞–π–ª:** `server/routes/squads.js:234-295`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å / Authorization

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≤ –ª—é–±–æ–π squad
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è creator –∏–ª–∏ member squad
- –í–æ–∑–º–æ–∂–Ω–∞ –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
if (squad.creator_id !== userId && !members.some(m => m.id === userId.toString())) {
  return sendError(res, 403, 'FORBIDDEN', 'Only squad members can add new members');
}
```

---

## üü† –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢

### 9. üü† –°–ò–ù–¢–ê–ö–°–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –í auth.js

**–§–∞–π–ª:** `server/middleware/auth.js:45`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞—é—â–∞—è —Ñ–∏–≥—É—Ä–Ω–∞—è —Å–∫–æ–±–∫–∞ `{` –ø–æ—Å–ª–µ `if (SESSION_TTL_REFRESH_SECONDS > 0)`
- –ö–æ–¥ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
if (SESSION_TTL_REFRESH_SECONDS > 0) {  // –î–æ–±–∞–≤–∏—Ç—å {
```

---

### 10. üü† console.log/warn/error –í PRODUCTION –ö–û–î–ï

**–§–∞–π–ª:** `server/index.js:36, 60, 747`, `server/migrations.js:511, 514`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `console.log/warn/error` –≤–º–µ—Å—Ç–æ `logger`
- –õ–æ–≥–∏ –Ω–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã
- –ù–µ—Ç —É—Ä–æ–≤–Ω–µ–π –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ `console.*` –Ω–∞ `logger.*`

---

### 11. üü† –û–¢–°–£–¢–°–¢–í–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò req.user –í SQUADS

**–§–∞–π–ª:** `server/routes/squads.js:94, 391`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `req.user?.first_name` –Ω–æ `req.user` –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ middleware
- –ö–æ–¥ –±—É–¥–µ—Ç –ø–∞–¥–∞—Ç—å —Å –æ—à–∏–±–∫–æ–π –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å undefined

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–ü–æ–ª—É—á–∞—Ç—å –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î –∏–ª–∏ –∏–∑ `initData` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ—Å—Å–∏–∏.

---

### 12. üü† –û–¢–°–£–¢–°–¢–í–ò–ï –ö–≠–®–ò–†–û–í–ê–ù–ò–Ø –î–õ–Ø SQUADS

**–§–∞–π–ª:** `server/routes/squads.js:11-50`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
- GET /api/squads –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∏–¥–µ—Ç –≤ –ë–î
- JSONB –∑–∞–ø—Ä–æ—Å—ã –º–µ–¥–ª–µ–Ω–Ω—ã–µ –±–µ–∑ –∫—ç—à–∞

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
const cacheKey = `squad:${userId}`;
const cached = await cache.get(cacheKey);
if (cached) return res.json({ ok: true, squad: cached });
// ... –∑–∞–ø—Ä–æ—Å –∫ –ë–î ...
await cache.set(cacheKey, normalizedSquad, 300); // 5 –º–∏–Ω—É—Ç TTL
```

---

### 13. üü† –û–¢–°–£–¢–°–¢–í–ò–ï –ü–ê–ì–ò–ù–ê–¶–ò–ò –í LEADERBOARD

**–§–∞–π–ª:** `server/routes/squads.js:423-450`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Leaderboard –Ω–µ –∏–º–µ–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ squads –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –º–µ–¥–ª–µ–Ω–Ω—ã–º
- –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ limit/offset

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ limit (–º–∞–∫—Å–∏–º—É–º 100).

---

### 14. üü† –û–¢–°–£–¢–°–¢–í–ò–ï –ò–ù–î–ï–ö–°–ê –î–õ–Ø witnesses.letter_id

**–§–∞–π–ª:** `server/migrations.js:312`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ò–Ω–¥–µ–∫—Å `idx_witnesses_letter` —Å–æ–∑–¥–∞–Ω, –Ω–æ –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º–∏
- –ù–µ—Ç —Å–æ—Å—Ç–∞–≤–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ –¥–ª—è `(user_id, letter_id)`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```sql
CREATE INDEX IF NOT EXISTS idx_witnesses_user_letter ON witnesses(user_id, letter_id);
```

---

### 15. üü† –û–¢–°–£–¢–°–¢–í–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò UUID –í WITNESSES

**–§–∞–π–ª:** `server/routes/witnesses.js:256, 309`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `witnessId` –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ UUID
- –í–æ–∑–º–æ–∂–Ω–∞ SQL injection —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
const { validate: validateUUID } = require('uuid');
if (!validateUUID(witnessId)) {
  return sendError(res, 400, 'INVALID_WITNESS_ID', 'Invalid witness ID format');
}
```

---

### 16. üü† –û–¢–°–£–¢–°–¢–í–ò–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø –ù–ê –ö–û–õ–ò–ß–ï–°–¢–í–û WITNESSES

**–§–∞–π–ª:** `server/routes/witnesses.js:108-130`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å / DoS

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–∏–¥–µ—Ç–µ–ª–µ–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í–æ–∑–º–æ–∂–Ω–∞ DoS —á–µ—Ä–µ–∑ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—ã—Å—è—á —Å–≤–∏–¥–µ—Ç–µ–ª–µ–π

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
const MAX_WITNESSES = 100;
const countResult = await pool.query(
  'SELECT COUNT(*) FROM witnesses WHERE user_id = $1',
  [userId]
);
if (parseInt(countResult.rows[0].count) >= MAX_WITNESSES) {
  return sendError(res, 400, 'TOO_MANY_WITNESSES', `Maximum ${MAX_WITNESSES} witnesses allowed`);
}
```

---

### 17. üü† –û–¢–°–£–¢–°–¢–í–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò letterId –í WITNESSES

**–§–∞–π–ª:** `server/routes/witnesses.js:22, 108, 309`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `letterId` –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Ñ–æ—Ä–º–∞—Ç
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ letterId —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–æ—Ä–º–∞—Ç–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞.

---

### 18. üü† –û–¢–°–£–¢–°–¢–í–ò–ï –¢–†–ê–ù–ó–ê–ö–¶–ò–ô –í WITNESSES UPDATE

**–§–∞–π–ª:** `server/routes/witnesses.js:133-242`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å / Race Condition

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ witness –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –í–æ–∑–º–æ–∂–Ω–∞ –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å `FOR UPDATE` –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π.

---

### 19. üü† –û–¢–°–£–¢–°–¢–í–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò –î–õ–ò–ù–´ –ò–ú–ï–ù–ò WITNESS

**–§–∞–π–ª:** `server/routes/witnesses.js:108-130`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω—ã –µ—Å—Ç—å (255), –Ω–æ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
- –í–æ–∑–º–æ–∂–Ω–∞ –∏–Ω—ä–µ–∫—Ü–∏—è —á–µ—Ä–µ–∑ Unicode —Å–∏–º–≤–æ–ª—ã

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–∞–ª–∏–¥–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
if (!/^[\w\s\-.,!?()]+$/u.test(name.trim())) {
  return sendError(res, 400, 'INVALID_NAME', 'Name contains invalid characters');
}
```

---

### 20. üü† –û–¢–°–£–¢–°–¢–í–ò–ï –ò–ù–î–ï–ö–°–ê –î–õ–Ø activity_feed.user_id + created_at

**–§–∞–π–ª:** `server/migrations.js:507`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ò–Ω–¥–µ–∫—Å —Å–æ–∑–¥–∞–Ω, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ —Ç–∏–ø—É
- –ù–µ—Ç —Å–æ—Å—Ç–∞–≤–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ –¥–ª—è `(user_id, activity_type, created_at)`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```sql
CREATE INDEX IF NOT EXISTS idx_activity_feed_user_type_created 
ON activity_feed(user_id, activity_type, created_at DESC);
```

---

## üü° –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢

### 21. üü° –û–¢–°–£–¢–°–¢–í–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò pactHealth –ü–†–ò –û–ë–ù–û–í–õ–ï–ù–ò–ò

**–§–∞–π–ª:** `server/routes/squads.js:177-180`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –í–∞–ª–∏–¥–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è –µ—Å—Ç—å (0-100), –Ω–æ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –¥—Ä–æ–±–Ω–æ–µ —á–∏—Å–ª–æ

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
if (!Number.isInteger(pactHealth) || pactHealth < 0 || pactHealth > 100) {
  return sendError(res, 400, 'INVALID_PACT_HEALTH', 'pactHealth must be integer between 0 and 100');
}
```

---

### 22. üü° –û–¢–°–£–¢–°–¢–í–ò–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø –ù–ê –î–õ–ò–ù–£ –ò–ú–ï–ù–ò SQUAD

**–§–∞–π–ª:** `server/routes/squads.js:68, 169`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –í–∞–ª–∏–¥–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è –µ—Å—Ç—å (255), –Ω–æ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã
- –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å squad —Å –ø—É—Å—Ç—ã–º –∏–º–µ–Ω–µ–º –ø–æ—Å–ª–µ trim()

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
if (name.trim().length < 3) {
  return sendError(res, 400, 'NAME_TOO_SHORT', 'Squad name must be at least 3 characters');
}
```

---

### 23. üü° –û–¢–°–£–¢–°–¢–í–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò –°–¢–†–£–ö–¢–£–†–´ member –û–ë–™–ï–ö–¢–ê

**–§–∞–π–ª:** `server/routes/squads.js:272-278, 389-395`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –í–∞–ª–∏–¥–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
- –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ –ø–æ–ª–µ–π –≤ member –æ–±—ä–µ–∫—Ç–µ

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å —Å—Ö–µ–º—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è member –æ–±—ä–µ–∫—Ç–∞.

---

### 24. üü° –û–¢–°–£–¢–°–¢–í–ò–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø –ù–ê –†–ê–ó–ú–ï–† JSONB –í –ë–î

**–§–∞–π–ª:** `server/migrations.js:291`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å / DoS

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–º–µ—Ä JSONB –ø–æ–ª—è `members`
- –í–æ–∑–º–æ–∂–Ω–∞ DoS —á–µ—Ä–µ–∑ –æ–≥—Ä–æ–º–Ω—ã–π JSON

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å CHECK constraint –∏–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

### 25. üü° –û–¢–°–£–¢–°–¢–í–ò–ï –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê –ú–ï–î–õ–ï–ù–ù–´–• –ó–ê–ü–†–û–°–û–í

**–§–∞–π–ª:** `server/middleware/performanceMonitor.js`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Performance monitor –µ—Å—Ç—å, –Ω–æ –Ω–µ—Ç –∞–ª–µ—Ä—Ç–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–µ—Ç –º–µ—Ç—Ä–∏–∫ –¥–ª—è JSONB –∑–∞–ø—Ä–æ—Å–æ–≤

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è JSONB –æ–ø–µ—Ä–∞—Ü–∏–π.

---

### 26. üü° –û–¢–°–£–¢–°–¢–í–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò squadId –§–û–†–ú–ê–¢–ê

**–§–∞–π–ª:** `server/routes/squads.js:145, 246, 309, 363`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `squadId` –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Ñ–æ—Ä–º–∞—Ç
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—É—é —Å—Ç—Ä–æ–∫—É

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
if (!squadId || !/^squad_\d+_[a-f0-9-]+$/.test(squadId)) {
  return sendError(res, 400, 'INVALID_SQUAD_ID', 'Invalid squad ID format');
}
```

---

### 27. üü° –û–¢–°–£–¢–°–¢–í–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò witnessId –§–û–†–ú–ê–¢–ê

**–§–∞–π–ª:** `server/routes/witnesses.js:256, 309`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `witnessId` –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Ñ–æ—Ä–º–∞—Ç –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—É—é —Å—Ç—Ä–æ–∫—É

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–æ—Ä–º–∞—Ç–∞ witness ID.

---

### 28. üü° –û–¢–°–£–¢–°–¢–í–ò–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø –ù–ê –ö–û–õ–ò–ß–ï–°–¢–í–û SQUADS –ù–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø

**–§–∞–π–ª:** `server/routes/squads.js:54-131`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å / DoS

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π squad, –Ω–æ –Ω–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–Ω–æ–≥–æ squads (–µ—Å–ª–∏ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–µ)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö squads.

---

### 29. üü° –û–¢–°–£–¢–°–¢–í–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò –î–ê–¢–´ –í member.lastCheckIn

**–§–∞–π–ª:** `server/routes/squads.js:96, 276, 393`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –í–∞–ª–∏–¥–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `lastCheckIn` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ `Date.now()`, –Ω–æ –Ω–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ frontend

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ `lastCheckIn` —è–≤–ª—è–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º timestamp.

---

### 30. üü° –û–¢–°–£–¢–°–¢–í–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò status –í member

**–§–∞–π–ª:** `server/routes/squads.js:95, 275, 392`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –í–∞–ª–∏–¥–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `status` —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—Å—è –∫–∞–∫ 'alive', –Ω–æ –Ω–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π status –∏–∑ frontend

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å enum –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª—è status.

---

### 31. üü° –û–¢–°–£–¢–°–¢–í–ò–ï –ò–ù–î–ï–ö–°–ê –î–õ–Ø squads.creator_id + created_at

**–§–∞–π–ª:** `server/migrations.js:298`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å—Ç—å –∏–Ω–¥–µ–∫—Å –Ω–∞ `creator_id`, –Ω–æ –Ω–µ—Ç —Å–æ—Å—Ç–∞–≤–Ω–æ–≥–æ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ `created_at`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```sql
CREATE INDEX IF NOT EXISTS idx_squads_creator_created ON squads(creator_id, created_at DESC);
```

---

### 32. üü° –û–¢–°–£–¢–°–¢–í–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò –î–õ–ò–ù–´ memberName

**–§–∞–π–ª:** `server/routes/squads.js:274`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –í–∞–ª–∏–¥–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `memberName` –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –¥–ª–∏–Ω—É
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω–æ–µ –∏–º—è

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
if (memberName && memberName.length > 100) {
  return sendError(res, 400, 'NAME_TOO_LONG', 'Member name exceeds 100 characters');
}
```

---

### 33. üü° –û–¢–°–£–¢–°–¢–í–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò avatarId –°–£–©–ï–°–¢–í–û–í–ê–ù–ò–Ø

**–§–∞–π–ª:** `server/routes/squads.js:277, 394`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –í–∞–ª–∏–¥–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `avatarId` –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
- –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞–≤–∞—Ç–∞—Ä

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞ —á–µ—Ä–µ–∑ `avatarsAPI` –∏–ª–∏ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É.

---

### 34. üü° –û–¢–°–£–¢–°–¢–í–ò–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø –ù–ê –†–ê–ó–ú–ï–† sharedPayload

**–§–∞–π–ª:** `server/routes/squads.js:177`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è –µ—Å—Ç—å –≤ –∫–æ–¥–µ –≤—ã—à–µ, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –æ–Ω–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö.

---

### 35. üü° –û–¢–°–£–¢–°–¢–í–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò –î–õ–ò–ù–´ –ò–ú–ï–ù–ò –í WITNESSES

**–§–∞–π–ª:** `server/routes/witnesses.js:108-130`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –í–∞–ª–∏–¥–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω—ã –µ—Å—Ç—å (255), –Ω–æ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
if (name.trim().length < 2) {
  return sendError(res, 400, 'NAME_TOO_SHORT', 'Witness name must be at least 2 characters');
}
```

---

## üü¢ –ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ / –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò

### 36. üü¢ –û–¢–°–£–¢–°–¢–í–ò–ï –ë–ê–¢–ß–ò–†–û–í–ê–ù–ò–Ø –î–õ–Ø –ú–ù–û–ñ–ï–°–¢–í–ï–ù–ù–´–• –û–ü–ï–†–ê–¶–ò–ô

**–§–∞–π–ª:** `server/routes/squads.js`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–ò–ó–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∑–∞ —Ä–∞–∑
- –ö–∞–∂–¥–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ - –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å endpoint –¥–ª—è –±–∞—Ç—á-–¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.

---

### 37. üü¢ –û–¢–°–£–¢–°–¢–í–ò–ï SOFT DELETE –î–õ–Ø SQUADS

**–§–∞–π–ª:** `server/routes/squads.js`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–ò–ó–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É–¥–∞–ª–∏—Ç—å squad
- –ù–µ—Ç soft delete –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `deleted_at` –∏ endpoint –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è.

---

### 38. üü¢ –û–¢–°–£–¢–°–¢–í–ò–ï –í–ï–†–°–ò–û–ù–ò–†–û–í–ê–ù–ò–Ø –î–õ–Ø SQUADS

**–§–∞–π–ª:** `server/routes/squads.js`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–ò–ó–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π squad
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É `squad_versions` –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `letter_versions`.

---

### 39. üü¢ –û–¢–°–£–¢–°–¢–í–ò–ï –ê–£–î–ò–¢–ê –ò–ó–ú–ï–ù–ï–ù–ò–ô

**–§–∞–π–ª:** `server/routes/squads.js, server/routes/witnesses.js`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–ò–ó–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å, –∫—Ç–æ –∏ –∫–æ–≥–¥–∞ –∏–∑–º–µ–Ω–∏–ª –¥–∞–Ω–Ω—ã–µ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –∞—É–¥–∏—Ç–∞ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

---

### 40. üü¢ –û–¢–°–£–¢–°–¢–í–ò–ï –ú–ï–¢–†–ò–ö –î–õ–Ø JSONB OPERATIONS

**–§–∞–π–ª:** `server/middleware/performanceMonitor.js`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–ò–ó–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è JSONB –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å JSONB –æ–ø–µ—Ä–∞—Ü–∏–π

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è JSONB.

---

### 41. üü¢ –û–¢–°–£–¢–°–¢–í–ò–ï –ö–≠–®–ò–†–û–í–ê–ù–ò–Ø –î–õ–Ø LEADERBOARD

**–§–∞–π–ª:** `server/routes/squads.js:423-450`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–ò–ó–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Leaderboard –Ω–µ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∏–¥–µ—Ç –≤ –ë–î

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å TTL 5-10 –º–∏–Ω—É—Ç.

---

### 42. üü¢ –û–¢–°–£–¢–°–¢–í–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò –î–õ–ò–ù–´ –ò–ú–ï–ù–ò –í LEADERBOARD

**–§–∞–π–ª:** `server/routes/squads.js:423-450`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–ò–ó–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –í–∞–ª–∏–¥–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ limit/offset –≤ leaderboard

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.

---

### 43. üü¢ –û–¢–°–£–¢–°–¢–í–ò–ï –ü–ê–ì–ò–ù–ê–¶–ò–ò –í WITNESSES

**–§–∞–π–ª:** `server/routes/witnesses.js:11-50`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–ò–ó–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
- GET /api/witnesses –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ witnesses –±–µ–∑ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
- –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –±—É–¥–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é —Å limit/offset.

---

### 44. üü¢ –û–¢–°–£–¢–°–¢–í–ò–ï –°–û–†–¢–ò–†–û–í–ö–ò –í WITNESSES

**–§–∞–π–ª:** `server/routes/witnesses.js:11-50`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–ò–ó–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** UX

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Witnesses —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ `created_at DESC`
- –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Å—Ç–∞—Ç—É—Å—É –∏–ª–∏ –∏–º–µ–Ω–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏.

---

### 45. üü¢ –û–¢–°–£–¢–°–¢–í–ò–ï –§–ò–õ–¨–¢–†–ê–¶–ò–ò –í WITNESSES

**–§–∞–π–ª:** `server/routes/witnesses.js:11-50`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–ò–ó–ö–ò–ô  
**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** UX

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É
- –ù–µ—Ç –ø–æ–∏—Å–∫–∞ –ø–æ –∏–º–µ–Ω–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫.

---

## üìã –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ):
1. ‚úÖ **–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫—É—é –æ—à–∏–±–∫—É –≤ auth.js** (–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `{`)
2. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è squads operations** (addMember, removeMember, join)
3. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è witnesses operations** (update, confirm)
4. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ä–∞–∑–º–µ—Ä–∞ JSONB** (members, sharedPayload)
5. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å GIN –∏–Ω–¥–µ–∫—Å –¥–ª—è squads.members**
6. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –≤ squads**
7. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ members/witnesses**
8. ‚úÖ **–ò—Å–ø—Ä–∞–≤–∏—Ç—å req.user –≤ squads.js**

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏):
9. ‚úÖ **–ó–∞–º–µ–Ω–∏—Ç—å console.* –Ω–∞ logger.***
10. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è squads**
11. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é UUID –¥–ª—è witnesses**
12. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–æ—Ä–º–∞—Ç–∞ squadId/witnessId**
13. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –¥–ª—è leaderboard**
14. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã**

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–≤ —Ç–µ—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞):
15. ‚úÖ **–£–ª—É—á—à–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Å–µ—Ö –ø–æ–ª–µ–π**
16. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ JSONB –æ–ø–µ—Ä–∞—Ü–∏–π**
17. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è avatarId**
18. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É –¥–ª—è –∏–º–µ–Ω**

---

## üéØ –í–´–í–û–î–´

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. ‚ùå **Race conditions –≤ squads –∏ witnesses** - –Ω—É–∂–Ω—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
2. ‚ùå **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ JSONB** - –≤–æ–∑–º–æ–∂–Ω–∞ DoS
3. ‚ùå **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞** - –≤–æ–∑–º–æ–∂–Ω–∞ –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è
4. ‚ùå **–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ auth.js** - –∫–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã:
1. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–∑–∞—â–∏—Ç–∞ –æ—Ç SQL injection)
2. ‚úÖ –ï—Å—Ç—å rate limiting
3. ‚úÖ –ï—Å—Ç—å security headers
4. ‚úÖ –ï—Å—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Zod
5. ‚úÖ –ï—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö (gifts, profile check-in, daily quests)

---

**–û—Ç—á–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω:** Senior QA –∏–Ω–∂–µ–Ω–µ—Ä –∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏  
**–î–∞—Ç–∞:** 2024-12-19
