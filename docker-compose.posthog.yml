# ─── PostHog Self-Hosted Analytics ──────────────────
# Run separately: docker compose -f docker-compose.posthog.yml up -d
# PostHog requires significant resources (min 4GB RAM)
# Access at: http://your-server:8100
#
# After first launch:
# 1. Go to http://your-server:8100
# 2. Create admin account
# 3. Get project API key
# 4. Set VITE_POSTHOG_KEY and VITE_POSTHOG_HOST in frontend .env

services:
  posthog-db:
    image: postgres:15
    environment:
      POSTGRES_USER: posthog
      POSTGRES_PASSWORD: ${POSTHOG_DB_PASSWORD:-posthog_pass}
      POSTGRES_DB: posthog
    volumes:
      - posthog_pgdata:/var/lib/postgresql/data
    networks:
      - posthog-net

  posthog-redis:
    image: redis:7-alpine
    networks:
      - posthog-net

  posthog:
    image: posthog/posthog:latest
    environment:
      DATABASE_URL: postgres://posthog:${POSTHOG_DB_PASSWORD:-posthog_pass}@posthog-db:5432/posthog
      REDIS_URL: redis://posthog-redis:6379
      SECRET_KEY: ${POSTHOG_SECRET_KEY:-change-me-in-production-posthog}
      SITE_URL: http://${POSTHOG_HOST:-localhost}:8100
      IS_BEHIND_PROXY: "false"
    depends_on:
      - posthog-db
      - posthog-redis
    ports:
      - "8100:8000"
    networks:
      - posthog-net

volumes:
  posthog_pgdata:

networks:
  posthog-net:
    driver: bridge
