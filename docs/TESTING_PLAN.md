# План тестирования приложения PressF

**Версия:** 1.0  
**Дата:** 16.02.2025

---

## 1. Цели и область тестирования

### 1.1 Цели
- Убедиться, что все заявленные функции работают корректно (функциональное тестирование).
- Проверить устойчивость к сетевым сбоям, неверным данным и граничным случаям.
- Оценить безопасность (авторизация, инъекции, XSS).
- Зафиксировать регрессии при изменениях кода (регрессионное тестирование).

### 1.2 В scope
- **Фронтенд:** React-приложение (экраны, навигация, формы, API-вызовы, локализация RU/EN).
- **Бэкенд:** Express API (роуты, middleware, БД, сессии).
- **Интеграция:** фронт ↔ API, сессии, Telegram WebApp (verify, initData).
- **Ключевые модули:** Auth, Profile, Store, Duels, Letters, Squads, Witnesses, Legacy, Daily Quests, Tournaments, Notifications, Activity, Events, Settings, Wiki, Search, Funeral DJ, Resurrection, Share.

### 1.3 Вне scope (по умолчанию)
- Нагрузочное/стресс-тестирование (если не запланировано отдельно).
- Тестирование внешних сервисов (Telegram, TON, боты) — только контракты и моки.

---

## 2. Типы тестирования

| Тип | Описание | Инструменты (рекомендация) |
|-----|----------|----------------------------|
| **Ручное функциональное** | Проверка сценариев по чек-листам | Чек-листы ниже, браузер/DevTools |
| **E2E** | Полные сценарии от входа до результата | Playwright / Cypress |
| **Интеграционное API** | Проверка ответов API при разных входных данных | Postman / REST-клиент, Jest + supertest |
| **Юнит-тесты** | Критичная бизнес-логика (утилиты, расчёты) | Jest, Vitest |
| **Регрессионное** | Повтор прогона критичных кейсов после изменений | Те же чек-листы / автотесты |
| **Безопасность** | Авторизация, инъекции, санитизация | Ручная проверка + проверка кода |

---

## 3. Окружения и предусловия

### 3.1 Окружения
- **Локаль:** фронт (`npm run dev`), бэкенд (Node + БД), доступ к Telegram WebApp в dev-режиме.
- **Staging (при наличии):** развёрнутое приложение с тестовой БД и тестовым ботом Telegram.
- **Production:** только smoke- и регрессия по критичным сценариям после деплоя.

### 3.2 Предусловия
- База данных поднята, миграции применены.
- Переменные окружения заданы (БД, секреты, опционально Telegram Bot Token).
- Для полного теста авторизации — тестовый Telegram-аккаунт и возможность открыть WebApp в Telegram (или эмуляция initData).

### 3.3 Тестовые данные
- Рекомендуется подготовить: тестового пользователя, несколько писем, дуэлей, сквадов, свидетелей, записей в Store/Legacy, чтобы проверять списки, пагинацию и граничные случаи.

---

## 4. Функциональное тестирование по модулям

### 4.1 Аутентификация и сессии

| ID | Сценарий | Шаги | Ожидаемый результат |
|----|----------|------|----------------------|
| AUTH-1 | Первый вход (verify) | Открыть приложение в Telegram, разрешить данные | Запрос verify с initData; в ответе session; сессия сохраняется; последующие запросы идут с X-Session-Id или cookie |
| AUTH-2 | Повторный вход с валидной сессией | Открыть приложение при уже сохранённой сессии | Нет лишних verify; запросы авторизованы; TTL сессии продлевается при активности |
| AUTH-3 | Истёкшая/невалидная сессия | Очистить сессию или подставить неверный sessionId | 401; фронт перенаправляет на повторную авторизацию / повторный verify |
| AUTH-4 | Запрос без сессии | Вызвать защищённый API без заголовка сессии | 401 Unauthorized |

---

### 4.2 Профиль и настройки

| ID | Сценарий | Шаги | Ожидаемый результат |
|----|----------|------|----------------------|
| PROF-1 | Загрузка профиля | Открыть Profile | Отображаются аватар, ник, уровень, опыт, REP, достижения, чек-ин, стрик |
| PROF-2 | Check-in | Нажать Check-in при доступности | Запрос check-in; обновление стрика и наград; сообщение об успехе |
| PROF-3 | Повторный check-in в тот же день | Повторно нажать Check-in | Ошибка или сообщение, что уже отмечено |
| PROF-4 | Обновление настроек | Settings: сменить язык, уведомления, short splash | Настройки сохраняются (localStorage + API где есть); язык меняется без перезагрузки; класс lang-ru выставляется для RU |
| PROF-5 | Смена языка RU ↔ EN | Переключить язык в Settings | Все подписи/тексты меняются; для RU применяется шрифт Stieglitz SP (если подключён) |

---

### 4.3 Store (магазин)

| ID | Сценарий | Шаги | Ожидаемый результат |
|----|----------|------|----------------------|
| STORE-1 | Загрузка каталога | Открыть Store | Список товаров (XP/Stars), балансы (XP, Stars), табы переключаются |
| STORE-2 | Покупка за XP | Купить товар за опыт (достаточно XP) | Списание XP; получение предмета; обновление баланса; остаётся корректный общий experience и spendableXp |
| STORE-3 | Покупка за XP при нехватке XP | Попытаться купить при недостатке XP | Кнопка неактивна или показ ошибки |
| STORE-4 | Mystery Box | Купить Mystery Box (120 XP) | Списание 120 XP; выпадение случайного предмета; обновление только spendableXp и данных профиля через loadData; experience не перезаписывается на remainingXp |
| STORE-5 | Покупки за Stars | При наличии Stars — покупка товара за Stars | Списание Stars; получение предмета; обновление баланса |
| STORE-6 | Пустой список / ошибка API | Отключить сеть или вернуть 500 | Отображается сообщение об ошибке или пустое состояние, без падения |

---

### 4.4 Duels (дуэли / beef)

| ID | Сценарий | Шаги | Ожидаемый результат |
|----|----------|------|----------------------|
| DUEL-1 | Список дуэлей | Открыть Duels | Список дуэлей (мои/публичные), пагинация, фильтры |
| DUEL-2 | Создание дуэли | Создать дуэль: оппонент, ставка, тема, дедлайн | Дуэль создаётся; отображается в списке; при успехе API показывается уведомление (без показа старого winnerTauntMessage при ошибке) |
| DUEL-3 | Редактирование дуэли | Изменить свою дуэль и сохранить | updateDuel вызывается; при успехе и наличии winnerTauntMessage показывается taunt |
| DUEL-4 | Определение победителя | Установить победителя (где разрешено) | Статус обновляется; winnerTauntMessage приходит в ответе и показывается только при result.ok |
| DUEL-5 | Просмотр дуэли (view) | Открыть дуэль на просмотр | Счётчик просмотров увеличивается; milestone при достижении |
| DUEL-6 | Удаление дуэли | Удалить свою дуэль | Дуэль исчезает из списка; delete API возвращает успех |

---

### 4.5 Letters (письма)

| ID | Сценарий | Шаги | Ожидаемый результат |
|----|----------|------|----------------------|
| LET-1 | Список писем | Открыть Letters | Список писем пользователя; пагинация; переход к деталям |
| LET-2 | Создание письма | Create Letter: заголовок, контент, получатели, дата открытия, опции | Письмо создаётся; редирект или возврат в список |
| LET-3 | Загрузка вложений | При создании письма прикрепить файлы | uploadAttachment вызывается; при успехе URL попадает в letter; при ошибке — сообщение и откат шага |
| LET-4 | Отправка письма | Завершить создание и отправить | Письмо в статусе отправлено; отображается в списке |
| LET-5 | Отмена / выход из создания | Выйти из Create Letter с заполненными полями | Подтверждение выхода; при подтверждении — возврат без сохранения черновика (или сохранение черновика по логике приложения) |
| LET-6 | Открытие письма (unlock) | Открыть письмо после unlock date | Контент расшифровывается и отображается (если логика предусмотрена) |

---

### 4.6 Squads (сквады)

| ID | Сценарий | Шаги | Ожидаемый результат |
|----|----------|------|----------------------|
| SQ-1 | Список сквадов | Открыть Squads | Список сквадов пользователя; кнопка создания |
| SQ-2 | Создание сквада | Создать сквад, имя | Сквад создаётся; отображается в списке |
| SQ-3 | Присоединение по ссылке/QR | Перейти по инвайт-ссылке или отсканировать QR | Присоединение к скваду; обновление списка |
| SQ-4 | Pact (общее хранилище) | Добавить/изменить контент в Pact | Сохранение payload; отображение для участников |
| SQ-5 | Голосование / пинг | Использовать голосование или пинг участников | Соответствующее API вызывается; UI обновляется |

---

### 4.7 Witnesses (свидетели)

| ID | Сценарий | Шаги | Ожидаемый результат |
|----|----------|------|----------------------|
| WIT-1 | Список свидетелей | Открыть свидетелей (из профиля или отдельный экран) | Список приглашённых свидетелей; приглашение по ссылке |
| WIT-2 | Приглашение свидетеля | Сгенерировать ссылку / отправить приглашение | Ссылка создаётся; новый свидетель появляется после принятия |
| WIT-3 | Witness approval (входящее) | Открыть экран подтверждения по ссылке | Отображается запрос; можно принять/отклонить |
| WIT-4 | Голосование при срабатывании таймера | (При наличии тестового сценария) Срабатывание Dead Man's Switch | Свидетели получают уведомление; голосование 2/3 учитывается |

---

### 4.8 Legacy

| ID | Сценарий | Шаги | Ожидаемый результат |
|----|----------|------|----------------------|
| LEG-1 | Список legacy-элементов | Открыть Legacy (из профиля/Wiki) | Список пунктов (враги, лут, манифесто, ghost и т.д.) |
| LEG-2 | Добавление/редактирование | Добавить или изменить пункт | Сохранение через API; отображение в списке |
| LEG-3 | Ghost / AI | Включить или настроить Ghost | Соответствующие настройки сохраняются (поведение зависит от реализации) |

---

### 4.9 Daily Quests и события

| ID | Сценарий | Шаги | Ожидаемый результат |
|----|----------|------|----------------------|
| DQ-1 | Список квестов | Открыть квесты (виджет/экран) | Отображаются дневные квесты и прогресс |
| DQ-2 | Прогресс и награды | Выполнить действие (check-in, дуэль, письмо и т.д.) | Прогресс квеста обновляется; при достижении — награда |
| EV-1 | Активные события | Открыть раздел событий / виджет | Список активных событий; прогресс и награды |
| EV-2 | Claim награды | Забрать награду события | Запрос claim; обновление баланса/предметов; флаг rewards_claimed обновлён |

---

### 4.10 Tournaments (турниры)

| ID | Сценарий | Шаги | Ожидаемый результат |
|----|----------|------|----------------------|
| TRN-1 | Список турниров | Открыть турниры | Активные/предстоящие турниры; участие и таблица |
| TRN-2 | Участие в турнире | Записаться в турнир | Успешная запись; отображение в «мои турниры» |
| TRN-3 | Обновление счёта/результатов | Отправить результат (если предусмотрено) | Счёт обновляется; таблица пересчитывается |

---

### 4.11 Notifications и Activity

| ID | Сценарий | Шаги | Ожидаемый результат |
|----|----------|------|----------------------|
| NOTIF-1 | Список уведомлений | Открыть Notifications | Список с пагинацией; прочитанные/непрочитанные |
| NOTIF-2 | Отметка прочтения | Отметить одно или все как прочитанные | API вызывается; UI обновляется |
| ACT-1 | Лента активностей | Открыть ленту (профиль/главная) | Активности загружаются; «подгрузить ещё» работает; при ошибке — сообщение без падения |

---

### 4.12 Остальные экраны

| ID | Сценарий | Шаги | Ожидаемый результат |
|----|----------|------|----------------------|
| WIKI-1 | Wiki | Открыть Wiki, переключать разделы | Контент загружается; разметка (Markdown) отображается корректно |
| SET-1 | Settings | Включить/выключить звук, уведомления, short splash | Сохранение в localStorage/API; поведение соответствует настройкам |
| SEARCH-1 | Поиск | Ввести запрос в Search | Результаты (пользователи/контент) отображаются; пустой результат и ошибки обрабатываются |
| DJ-1 | Funeral DJ | Открыть экран, воспроизведение | Плеер работает; список треков загружается |
| RES-1 | Resurrection | Открыть экран (при наличии доступа) | Контент отображается; глитч-эффекты не ломают верстку |
| SHARE-1 | Share | Поделиться постом/ссылкой | Генерация ссылки или шаринга в соцсети по логике приложения |

---

## 5. Навигация, UI, локализация

| ID | Сценарий | Шаги | Ожидаемый результат |
|----|----------|------|----------------------|
| NAV-1 | Нижняя навигация | Переход по вкладкам: Home, Letters, Store, Search, Duels, Profile | Соответствующие маршруты открываются; активная вкладка подсвечена |
| NAV-2 | Breadcrumbs | Перейти в подраздел (например, Store → вкладка) | Хлебные крошки отображаются; переход по ним работает |
| NAV-3 | 404 / неизвестный путь | Перейти по несуществующему URL | Отображается страница 404 или редирект на главную |
| UI-1 | Светлая тема | Включить светлую тему (если есть) | Цвета и контраст соответствуют светлой теме |
| UI-2 | Reduced motion | Включить «уменьшить движение» в ОС | Анимации отключаются или упрощаются |
| L10N-1 | RU | Язык RU | Все строки на русском; шрифт основного текста — Stieglitz SP |
| L10N-2 | EN | Язык EN | Все строки на английском; шрифт по умолчанию (Fondamento) |

---

## 6. Граничные случаи и устойчивость

| ID | Сценарий | Шаги | Ожидаемый результат |
|----|----------|------|----------------------|
| EDGE-1 | Нет сети | Отключить сеть, выполнить действие | Сообщение об ошибке/офлайн; нет белого экрана; при появлении сети — возможность повторить |
| EDGE-2 | Таймаут API | Задержать ответ сервера > таймаута | Таймаут на фронте; сообщение пользователю; ретраи по логике apiRequest |
| EDGE-3 | Пустые списки | Открыть раздел с нулевыми данными (письма, дуэли, уведомления) | Пустое состояние (empty state), без ошибок в консоли |
| EDGE-4 | Большие данные | Списки с пагинацией (limit/offset) | Нет падения; корректные limit/offset в запросах; при необходимости — «загрузить ещё» |
| EDGE-5 | Невалидный ввод | В формах: пустые обязательные поля, неверный формат даты, слишком длинный текст | Валидация на фронте и/или ошибка от API; сообщение пользователю |

---

## 7. Безопасность (чек-лист)

| ID | Проверка | Ожидаемый результат |
|----|----------|----------------------|
| SEC-1 | Защищённые роуты без сессии | Все защищённые API без валидной сессии возвращают 401 |
| SEC-2 | Чужие ресурсы | Запрос письма/дуэли/профиля другого пользователя только по правилам (публичное/разрешённое); иначе 403 |
| SEC-3 | Санитизация ввода | Текстовые поля (ник, описание, контент писем) санитизируются на бэкенде; нет сохранения сырого HTML/скриптов |
| SEC-4 | XSS | Нет отображения пользовательского контента через innerHTML без санитизации; ошибки в index.tsx только через textContent |
| SEC-5 | Параметры запросов | limit/offset и прочие числа парсятся с radix; границы проверяются (max limit и т.д.) |

---

## 8. Регрессионный прогон (минимум после изменений)

Рекомендуемый минимальный набор после правок в коде:

1. **AUTH-1, AUTH-2** — вход и работа с сессией.  
2. **PROF-1, PROF-2, PROF-4, PROF-5** — профиль, check-in, настройки, язык.  
3. **STORE-2, STORE-4** — покупка за XP и Mystery Box (проверка бага с experience).  
4. **DUEL-2, DUEL-3, DUEL-4** — создание, редактирование, победитель и taunt.  
5. **LET-2, LET-3** — создание письма и вложения.  
6. **NAV-1, L10N-1** — навигация и русская локаль.

При изменении конкретного модуля — полный подраздел этого модуля из раздела 4.

---

## 9. Автоматизация (рекомендации)

- **E2E:** Playwright или Cypress — сценарии: вход (с моком initData), главная, профиль, check-in, Store (покупка за XP), создание дуэли, создание письма, смена языка.
- **API:** Supertest + Jest — роуты: `/api/auth/verify`, `/api/profile`, `/api/store/buy`, `/api/duels`, `/api/letters` (создание, вложения) — проверка кодов ответа и структуры тела при валидных/невалидных данных.
- **Юнит:** утилиты (sanitize, расчёт уровня/опыта, форматирование дат) — покрытие тестами.

---

## 10. Артефакты и отчётность

- **Чек-листы:** выполнение по разделам 4–7 с отметкой Pass/Fail и комментарием при падении.
- **Баги:** описание шагов, ожидание, факт, окружение, скрин/лог при необходимости.
- **Регрессия:** список кейсов (раздел 8) и результат прогона с датой и версией билда.
- **Итог:** краткий отчёт о прогоне (сколько кейсов пройдено/провалено, критические дефекты, рекомендации).

---

*Документ можно расширять: добавлять конкретные тест-кейсы, данные для тестовых пользователей и ссылки на тест-планы в трекере задач.*
